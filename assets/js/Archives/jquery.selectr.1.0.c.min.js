(function(e){e.fn.selectr=function(t,n){var r=e.extend({},e.fn.selectr.defaults,t);return this.each(function(){var s=e(this),o=s.find("thead"),u=s.find("tbody"),a=s.find("tfoot"),f="input[type=checkbox].",l=e.meta?e.extend({},r,s.data()):r;l.position==="right"?(l.checkMax===0?o.find("tr").append('<th><input type="checkbox" class="'+l.selectr+'" /></th>'):o.find("tr").append("<th></th>"),u.find("tr").each(function(){e(this).append('<td><input type="checkbox" class="'+l.selectr+'" id="'+e(this).prop("id")+'"  /></td>')})):(l.checkMax===0?o.find("tr").prepend('<th><input type="checkbox" class="'+l.selectr+'" /></th>'):o.find("tr").prepend("<th></th>"),u.find("tr").each(function(){e(this).prepend('<td><input type="checkbox" class="'+l.selectr+'" id="'+e(this).prop("id")+'"  /></td>')}));var c=o.find("."+l.selectr),h=u.find("."+l.selectr);e.fn.selectr.settingCount(s,l.position,l.selectrCount,l.checkMax,h,l.leadingZero,l.count);var p=u.parent().data("total");h.click(function(){u.data("highlight")||u.data("highlight",l.highlight);var r=u.data("highlight");e(this).parent().parent().toggleClass(r),e.fn.selectr.updateCount(u,a,f,p,r,t),l.checkMax!==0&&($disCheck=u.find(f+l.selectr+":not(:checked)"),$totCheck===l.checkMax?$disCheck.prop("disabled",!0):$disCheck.prop("disabled",!1),$totCheck==p&&l.callbackType==="checkMax"&&typeof n=="function"&&n.call(this));var s=e(this).closest("tr")[0].rowIndex,o=1;if(window.shiftkey){u.parent().data(l.lastChecked)>s?(first=s,last=u.parent().data(l.lastChecked)):(first=u.parent().data(l.lastChecked),last=s);for(i=first;i<last+1;i+=1)if(o!=l.checkMax){var h=u.find("tr:nth-child("+i+")");u.parent().data(l.lastCheckedState)===!0?h.addClass(r):h.removeClass(r),h.find("."+l.selectr).prop("checked",u.parent().data(l.lastCheckedState)),o+=1}window.shiftkey=!1}e.fn.selectr.updateCount(u,a,f,p,r,t),l.checkMax===0&&($totCheck==0?c.prop({indeterminate:!1,checked:!1}):$totCheck==p?c.prop({indeterminate:!1,checked:!0}):c.prop({indeterminate:!0,checked:!1})),u.parent().data(l.lastChecked,s),u.parent().data(l.lastCheckedState,e(this).prop("checked")),l.callbackType==="immediate"&&typeof n=="function"&&n.call(this)}),c.click(function(){u.data("highlight")||u.data("highlight",l.highlight);var r=u.data("highlight");h.prop("checked",function(){return c.prop("checked")}).parent().parent().toggleClass(r,c.prop("checked")),e.fn.selectr.updateCount(u,a,f,p,r,t),l.callbackType==="immediate"&&typeof n=="function"&&n.call(this)})})},e.fn.selectr.settingCount=function(e,t,n,r,i,s,o){var u,a=e.find("tfoot");r===0?u=i.length:u=(s+r).slice(-2),o&&a.find("."+n).length===0&&(t==="right"?a.find("tr").append('<td><span class="'+n+'">'+("0"+s).slice(-2)+"/"+u+"</span></td>"):a.find("tr").prepend('<td><span class="'+n+'">'+("0"+s).slice(-2)+"/"+u+"</span></td>")),e.data("total",u)},e.fn.selectr.updateCount=function(t,n,r,i,s,o){var u=e.extend({},e.fn.selectr.defaults,o),a=e.meta?e.extend({},u,$this.data()):u;$totChecked=t.find(r+a.selectr+":checked"),$totCheck=$totChecked.length,a.count&&(n.find("."+a.selectrCount).text((a.leadingZero+$totCheck).slice(-2)+"/"+i),$totCheck==i?n.find("."+a.selectrCount).parent().addClass(s):n.find("."+a.selectrCount).parent().removeClass(s)),e.fn.selectr.checkedRows(t,r,a.selectr,a.checkedRows)},e.fn.selectr.checkedRows=function(t,n,r,i){var s=new Array;t.find(n+r+":checked").each(function(){s.push(e(this).prop("id"))}),t.parent().data(i,s)},e.fn.selectr.listToCheck=function(t,n,r,s){var o=e.extend({},e.fn.selectr.defaults,r),u=e.meta?e.extend({},o,$this.data()):o,t=e(t),a=t.find("thead ."+u.selectr),f=t.find("tbody"),l=t.find("tfoot"),c="[type=checkbox].",h=f.find(c+u.selectr),p=n.length;f.data("highlight")||f.data("highlight",u.highlight);var d=f.data("highlight");e.fn.selectr.settingCount(t,u.position,u.selectrCount,u.checkMax,h,u.leadingZero,u.count);if(p!==0){p===h.length?a.prop("checked",!0):a.prop("indeterminate",!0);for(i=0;i<p;i+=1)t.find("#"+n[i]).find("."+u.selectr).prop("checked",!0).parent().parent().addClass(d)}var v=f.parent().data("total");e.fn.selectr.updateCount(f,l,c,v,d,r),typeof s=="function"&&s.call(this)},e.fn.selectr.defaults={selectr:"selectr",selectrCount:"selectrCount",highlight:"highlighted",count:!1,leadingZero:"",checkMax:0,checkedRows:"checkedRows",lastChecked:"lastChecked",lastCheckedState:"lastCheckedState",callbackType:"immediate",position:"right"}})(jQuery)