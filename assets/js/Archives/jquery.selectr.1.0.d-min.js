(function(e){e.fn.selectr=function(t,n){return this.each(function(){var r=e(this),s=r.find("thead"),o=r.find("tbody"),u=r.find("tfoot"),a="[type=checkbox].",f=e.extend({},e.fn.selectr.defaults,t);if(f.position==="right"){f.checkMax===0?s.find("tr").append('<th><input type="checkbox" class="'+f.selectr+'" /></th>'):s.find("tr").append("<th></th>");o.find("tr").each(function(){e(this).append('<td><input type="checkbox" class="'+f.selectr+'" /></td>')})}else{f.checkMax===0?s.find("tr").prepend('<th><input type="checkbox" class="'+f.selectr+'" /></th>'):s.find("tr").prepend("<th></th>");o.find("tr").each(function(){e(this).prepend('<td><input type="checkbox" class="'+f.selectr+'" /></td>')})}var l=s.find("."+f.selectr),c=o.find("."+f.selectr);e.fn.selectr.settingCount(r,c,t);var h=r.data("total");c.click(function(){e(this).parent().parent().toggleClass(f.highlight);e.fn.selectr.updateCount(r,u,a,h,t,false,false);var s=r.data("totCheck")||0;if(f.checkMax!==0){o.find(a+f.selectr+":not(:checked)").prop("disabled",s===f.checkMax);if(s==h&&f.callbackType==="checkMax"&&typeof n==="function"){n.call(this)}}var c=e(this).closest("tr")[0].rowIndex,p=1;if(window.shiftkey){r.data(f.lastChecked)>c?(first=c,last=r.data(f.lastChecked)):(first=r.data(f.lastChecked),last=c);for(i=first;i<last+1;i=i+1){if(p!=f.checkMax){var d=o.find("tr:nth-child("+i+")");d.toggleClass(f.highlight,r.data(f.lastCheckedState)===true);d.find("."+f.selectr).prop("checked",r.data(f.lastCheckedState));p+=1}}window.shiftkey=false}r.data(f.lastChecked,c);r.data(f.lastCheckedState,e(this).prop("checked"));e.fn.selectr.updateCount(r,u,a,h,t,true,false);if(f.checkMax===0){if(s==0){l.prop({indeterminate:false,checked:false})}else if(s==h){l.prop({indeterminate:false,checked:true})}else{l.prop({indeterminate:true,checked:false})}}if(f.callbackType==="immediate"&&typeof n==="function"){n.call(this)}});l.click(function(){c.prop("checked",l.prop("checked")).parent().parent().toggleClass(f.highlight,l.prop("checked"));e.fn.selectr.updateCount(r,u,a,h,t,true,true);if(f.callbackType==="immediate"&&typeof n==="function"){n.call(this)}})})};e.fn.selectr.settingCount=function(t,n,r){var i=e.extend({},e.fn.selectr.defaults,r);var s=t.find("tfoot"),o=i.checkMax===0?n.length:(i.leadingZero+i.checkMax).slice(-2);if(i.count){if(s.find("."+i.selectrCount).length===0){var u='<td><span class="'+i.selectrCount+'">'+("0"+i.leadingZero).slice(-2)+"/"+o+"</span></td>";i.position==="right"?s.find("tr").append(u):s.find("tr").prepend(u)}}t.data("total",o)};e.fn.selectr.updateCount=function(t,n,r,i,s,o,u){var a=e.extend({},e.fn.selectr.defaults,s);var f=t.find("tbody "+r+a.selectr+":checked"),l=f.length;if(a.count){n.find("."+a.selectrCount).text((a.leadingZero+l).slice(-2)+"/"+i);n.find("."+a.selectrCount).parent().toggleClass(a.highlight,l==i)}t.data("totCheck",l);if(o===true){e.fn.selectr.checkedRows(t,r,s,u)}};e.fn.selectr.checkedRows=function(t,n,r,i){var s=e.extend({},e.fn.selectr.defaults,r),o=new Array;if(s.order==="by_click"&&i===false){var o=t.data(s.checkedRows)||o;if(t.data(s.lastChecked)){var u=t.find("tbody tr:nth-child("+t.data(s.lastChecked)+")").prop("id");t.data(s.lastCheckedState)===true?o.push(u):o.splice(o.indexOf(u),1)}}else{t.find("tbody "+n+s.selectr+":checked").each(function(){o.push(e(this).parent().parent().prop("id"))})}t.data(s.checkedRows,o)};e.fn.selectr.listToCheck=function(t,n,r,s){var o=e.extend({},e.fn.selectr.defaults,r);var u=e(t),a=u.find("thead ."+o.selectr),f=u.find("tbody"),l=u.find("tfoot"),c="[type=checkbox].",h=f.find(c+o.selectr),p=n.length;e.fn.selectr.settingCount(u,h,r);if(p!==0){p===h.length?a.prop("checked",true):a.prop("indeterminate",true);for(i=0;i<p;i=i+1){u.find("#"+n[i]).find("."+o.selectr).prop("checked",true).parent().parent().addClass(o.highlight)}}var d=u.data("total");e.fn.selectr.updateCount(u,l,c,d,r,true);if(typeof s==="function"){s.call(this)}};e.fn.selectr.defaults={selectr:"selectr",selectrCount:"selectrCount",highlight:"highlighted",count:false,leadingZero:"",checkMax:0,checkedRows:"checkedRows",lastChecked:"lastChecked",lastCheckedState:"lastCheckedState",callbackType:"immediate",position:"right",order:""}})(jQuery)